%define duration = 1s

var repeats = 0
var ended = false

tone tone (
    frequency = 440.0
    duration = duration
    repeats = repeats
    amplitude = 0.5
    ended = ended
    )


%define start_delay = 2s

%define play_with_repeats (num_repeats)
    trial {
        repeats = num_repeats
        ended = false

        report ('Playing with repeats = $repeats')
        play_sound (
            sound = tone
            start_time = now() + start_delay
            )
        assert (not ended)

        wait (start_delay + duration * repeats)
        assert (not ended)

        wait_for_condition (
            condition = ended
            timeout = duration + 200ms
            )
        wait (1s)
    }
%end

protocol {
    block (selection = random_without_replacement) {
        play_with_repeats (0)
        play_with_repeats (1)
        play_with_repeats (2)
        play_with_repeats (3)
    }
}
